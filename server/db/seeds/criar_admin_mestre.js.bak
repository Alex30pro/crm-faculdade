const bcrypt = require('bcryptjs');

exports.seed = async function(knex) {
  const adminEmail = 'admin@crm.com';
  const adminNome = 'Admin Master';

  const adminExists = await knex('usuarios').where({ email: adminEmail }).first();

  if (!adminExists) {
    console.log(`Usuário ${adminEmail} não encontrado, criando novo...`);
    
    const saltRounds = 10;
    const adminPassword = 'admin'; // Defina a senha padrão inicial aqui
    const hashedPassword = await bcrypt.hash(adminPassword, saltRounds);

    await knex('usuarios').insert({
      nome: adminNome,
      email: adminEmail,
      senha_hash: hashedPassword,
      role: 'admin',
      is_active: true
    });
    
    console.log(`Usuário ${adminEmail} criado com sucesso.`);
  } else {
    console.log(`Usuário ${adminEmail} já existe. Nenhuma ação necessária.`);
  }
};
